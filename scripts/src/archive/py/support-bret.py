import os
from openai import OpenAI
import subprocess


def get_1password_secret(item_name):
    "op item get OPEN_AI_KEY --fields notesPlain"
    try:
        result = subprocess.run(
            ["op", "item", "get", "OPEN_AI_KEY", "--field", "notesPlain"],
            capture_output=True,
            text=True,
            check=True
        )
        return result.stdout.strip()
    except subprocess.CalledProcessError as e:
        print(f"Error retrieving secret from 1Password: {e}")
        return None


api_key = get_1password_secret("OPEN_AI_KEY")


client = OpenAI(api_key=api_key)



# Paths and folders

image_folder = '/Users/shelbernstein/homelab/data/images'
output_folder = '/Users/shelbernstein/homelab/data/diagrams'

if not os.path.exists(output_folder):
    os.makedirs(output_folder)

# Collect all images in the folder
image_urls = [f"https://hashirama.blog/derp/support_bret/images/{image}" for image in os.listdir(image_folder)]

# Function to create a chat message for OpenAI API
def make_message(i, image_url):
    better_prompt = """
  use esm module imports for d3 and threejs

  render 3 diagrrams 

  --- get existing diagrams 
  """
    
    #"pass it text from the paper " - "all images from paper" 


    
    messages = [
        {
            "role": "user",
            "content": [
                { "type": "text", "text": "You are an expert in JavaScript. Please generate valid, executable JavaScript code using Three.js or d3.js or both - whichever you think is applicable. The code should load an image from the following URL: {image_url} and create a 3D visualization related to the image. Ensure the code is valid and ready to execute in a web environment without any additional modification" },
                {
                    "type": "image_url",
                    "image_url": {
                        "url": image_url
                    },
                },
            ]
        }
    ]
    return messages

# Iterate over the image URLs to create diagrams
for i, image_url in enumerate(image_urls[:10]):
    print(f"Processing image {i + 1}")
    
    messages = make_message(i, image_url)
    try:
        response = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=messages
        )
    except Exception as e:
        print(f"Error generating diagram: {e}")
        continue
    
    # Access the content returned by OpenAI API
    content = response.choices[0].message.content
    
    # Save the JavaScript output to a file
    js_output_path = os.path.join(output_folder, f'{i}.js')
    with open(js_output_path, 'w') as f:
        f.write(content)
    
    print(f"Saved diagram to {js_output_path}")

print('Complete')






[
    "http://gamelab.mit.edu/games/a-slower-speed-of-light/",
    "https://explorabl.es/physics",
    "https://beta.observablehq.com/",
    "https://explorabl.es/tools",
    "http://marctenbosch.com/quaternions/",
    "https://explorabl.es/math",
    "https://explorabl.es/programming",
    "http://galgreen.com/TaxiCabProblem/",
    "https://explorabl.es/math",
    "https://quantum.country/qcvc",
    "https://explorabl.es/physics",
    "https://explorabl.es/programming",
    "https://idyll-lang.org/",
    "https://explorabl.es/tools",
    "https://manytinythings.github.io/",
    "https://explorabl.es/physics",
    "http://ncase.me/crowds/",
    "https://explorabl.es/social",
    "https://dood.al/pinktrombone/",
    "https://explorabl.es/misc",
    "https://megan-vo.github.io/basic-beats/",
    "https://explorabl.es/art",
    "http://ncase.me/fireflies/",
    "https://explorabl.es/biology",
    "https://mathisonian.github.io/idyll/how-to-tune-a-guitar/",
    "https://explorabl.es/art",
    "http://viruspatterns.com/",
    "https://explorabl.es/biology",
    "https://www.lightnote.co/",
    "https://explorabl.es/art",
    "https://distill.pub/",
    "https://explorabl.es/programming",
    "http://worrydream.com/LadderOfAbstraction/",
    "https://explorabl.es/meta",
    "http://www.redblobgames.com/pathfinding/a-star/introduction.html",
    "https://explorabl.es/programming",
    "http://worrydream.com/ExplorableExplanations/",
    "https://explorabl.es/reading",
    "https://demoman.net/?a=trig-for-games",
    "https://explorabl.es/art",
    "https://explorabl.es/math",
    "https://explorabl.es/programming",
    "https://jackschaedler.github.io/handwriting-recognition/",
    "https://explorabl.es/programming",
    "http://ncase.me/ballot/",
    "https://explorabl.es/civics",
    "http://4dtoys.com/",
    "https://explorabl.es/math",
    "https://mindstorms.media.mit.edu/",
    "https://explorabl.es/reading",
    "https://labs.minutelabs.io/what-is-a-day/",
    "https://explorabl.es/physics",
    "https://spaciecat.github.io/cells/",
    "https://explorabl.es/math",
    "https://ncase.me/covid-19/",
    "https://explorabl.es/biology",
    "http://ncase.me/trust/",
    "https://explorabl.es/social",
    "https://learningmusic.ableton.com/",
    "https://explorabl.es/art",
    "https://www.theguardian.com/australia-news/datablog/ng-interactive/2017/sep/28/hooked-how-pokies-are-designed-to-be-addictive",
    "https://explorabl.es/journalism",
    "https://explorabl.es/psychology",
    "http://www.jezzamon.com/fourier/index.html",
    "https://explorabl.es/math",
    "https://testtubegames.com/weightless.html",
    "https://explorabl.es/physics",
    "http://www.earthprimer.com/",
    "https://explorabl.es/earth",
    "https://eater.net/quaternions",
    "https://explorabl.es/math",
    "http://worrydream.com/MediaForThinkingTheUnthinkable/",
    "https://explorabl.es/reading",
    "https://www.complexity-explorables.org/",
    "https://explorabl.es/biology",
    "https://explorabl.es/math",
    "https://explorabl.es/physics",
    "https://jackschaedler.github.io/circles-sines-signals/",
    "https://explorabl.es/math",
    "http://polytrope.com/district/",
    "https://explorabl.es/civics",
    "https://mathigon.org/",
    "https://explorabl.es/math",
    "https://pudding.cool/2018/02/waveforms/",
    "https://explorabl.es/math",
    "https://explorabl.es/physics",
    "https://ciechanow.ski/gears/",
    "https://explorabl.es/math",
    "https://explorabl.es/physics",
    "https://explorabl.es/jam/",
    "https://explorabl.es/misc",
    "https://www.meltingasphalt.com/interactive/going-critical/",
    "https://explorabl.es/math",
    "https://explorabl.es/social",
    "http://students.brown.edu/seeing-theory/",
    "https://explorabl.es/math",
    "http://ncase.me/polygons/",
    "https://explorabl.es/social",
    "http://cassandraxia.com/projs/advbiases/",
    "https://explorabl.es/psychology",
    "https://ncase.me/remember/",
    "https://explorabl.es/psychology",
    "https://testtubegames.com/games.html",
    "https://explorabl.es/physics",
    "https://www.osar.fr/notes/logspherical/",
    "https://explorabl.es/art",
    "https://explorabl.es/programming",
    "http://www.redblobgames.com/making-of/line-drawing/",
    "https://explorabl.es/meta",
    "https://explorabl.es/tutorials",
    "http://vf.rohanp.xyz/",
    "https://explorabl.es/math",
    "http://worrydream.com/ScientificCommunicationAsSequentialArt/",
    "https://explorabl.es/meta",
    "https://observablehq.com/@tmcw/enigma-machine",
    "https://explorabl.es/misc",
    "http://soup.gua-le-ni.com/",
    "https://explorabl.es/philosophy",
    "http://labs.minutelabs.io/Chaotic-Pendulum/",
    "https://explorabl.es/physics",
    "https://johnaustin.io/articles/2018/voting-systems",
    "https://explorabl.es/civics",
    "http://ncase.me/sight-and-light/",
    "https://explorabl.es/programming",
    "https://shaunlebron.github.io/visualizing-projections/",
    "https://explorabl.es/programming",
    "https://fivethirtyeight.com/features/how-to-win-a-nuclear-standoff/",
    "https://explorabl.es/journalism",
    "https://demoman.net/?a=basics-of-vector-math",
    "https://explorabl.es/art",
    "https://explorabl.es/math",
    "https://explorabl.es/programming",
    "http://quantumgame.io/",
    "https://explorabl.es/physics",
    "https://explore.paulbutler.org/bet/",
    "https://explorabl.es/math",
    "https://roadtolarissa.com/oracle/",
    "https://explorabl.es/programming",
    "https://fivethirtyeight.com/features/science-isnt-broken/",
    "https://explorabl.es/journalism",
    "https://mathisonian.github.io/kde/",
    "https://explorabl.es/math",
    "http://labs.minutelabs.io/Chaotic-Planets/",
    "https://explorabl.es/physics",
    "https://apps.apple.com/us/app/hilbert-curves/id1453611170",
    "https://explorabl.es/math",
    "http://www.econgraphs.org/",
    "https://explorabl.es/economics",
    "https://www.themarshallproject.org/2015/08/04/the-new-science-of-sentencing",
    "https://explorabl.es/journalism",
    "https://maxgoldste.in/invitation-to-another-dimension/",
    "https://explorabl.es/math",
    "http://jackterwilliger.com/biological-neural-networks-part-i-spiking-neurons/",
    "https://explorabl.es/biology",
    "http://www.possibilityspace.org/tutorial-generative-possibility-space/",
    "https://explorabl.es/art",
    "https://explorabl.es/programming",
    "https://eyewire.org/",
    "https://explorabl.es/biology",
    "http://here.gua-le-ni.com/",
    "https://explorabl.es/philosophy",
    "https://algassert.com/quantum/2014/03/07/Building-your-own-Quantum-Fourier-Transform.html",
    "https://explorabl.es/programming",
    "https://www.pippinbarr.com/games/trolleyproblem/TrolleyProblem.html",
    "https://explorabl.es/philosophy",
    "https://blog.codinghorror.com/our-programs-are-fun-to-use/",
    "https://explorabl.es/reading",
    "https://www.khanacademy.org/research/reports/cantor",
    "https://explorabl.es/math",
    "https://explorabl.es/meta",
    "https://www.dougengelbart.org/pubs/augment-3906.html",
    "https://explorabl.es/reading",
    "https://polyhedra.tessera.li/",
    "https://explorabl.es/math",
    "http://immersivemath.com/ila/index.html",
    "https://explorabl.es/math",
    "https://www.nytimes.com/interactive/2018/11/18/opinion/thanksgiving-family-argue-chat-bot.html",
    "https://explorabl.es/civics",
    "https://explorabl.es/journalism",
    "https://freelanceastro.github.io/bell/",
    "https://explorabl.es/physics",
    "http://ncase.me/neurons/",
    "https://explorabl.es/psychology",
    "https://tinlizzie.org/tinkertoy/",
    "https://explorabl.es/biology",
    "https://explorabl.es/programming",
    "https://dmsm.github.io/scissors-congruence/",
    "https://explorabl.es/math",
    "https://kineticgraphs.org/",
    "https://explorabl.es/tools",
    "https://www.nytimes.com/interactive/2017/04/14/upshot/drug-overdose-epidemic-you-draw-it.html",
    "https://explorabl.es/journalism",
    "https://workshop.chromeexperiments.com/examples/gui/#1--Basic-Usage",
    "https://explorabl.es/tools",
    "https://blog.bruce-hill.com/6-useful-snippets",
    "https://explorabl.es/programming",
    "https://www.nytimes.com/interactive/2014/upshot/buy-rent-calculator.html",
    "https://explorabl.es/economics",
    "https://www.kellianderson.com/books/planetarium.html",
    "https://explorabl.es/misc",
    "http://playground.tensorflow.org/",
    "https://explorabl.es/programming",
    "http://worrydream.com/KillMath/",
    "https://explorabl.es/math",
    "https://thebookofshaders.com/",
    "https://explorabl.es/programming",
    "http://spotthedrowningchild.com/",
    "https://explorabl.es/misc",
    "http://moralmachine.mit.edu/",
    "https://explorabl.es/philosophy",
    "http://www.bbc.com/news/world-middle-east-32057601",
    "https://explorabl.es/journalism",
    "http://matrixmultiplication.xyz/",
    "https://explorabl.es/math",
    "https://www.bloomberg.com/graphics/2015-paul-ford-what-is-code/",
    "https://explorabl.es/journalism",
    "https://explorabl.es/programming",
    "https://blog.ncase.me/explorable-explanations-4-more-design-patterns/",
    "https://explorabl.es/tutorials",
    "https://www.nytimes.com/interactive/2015/05/28/upshot/you-draw-it-how-family-income-affects-childrens-college-chances.html",
    "https://explorabl.es/journalism",
    "http://www.possibilityspace.org/tutorial-sampling/index.html",
    "https://explorabl.es/art",
    "https://explorabl.es/programming",
    "http://www.cdglabs.org/sudoku-observer/",
    "https://explorabl.es/misc",
    "https://www.bloomberg.com/features/2015-stock-chart-trading-game/",
    "https://explorabl.es/economics",
    "https://aatishb.com/entropy/",
    "https://explorabl.es/physics",
    "https://www.washingtonpost.com/graphics/2020/world/corona-simulator/",
    "https://explorabl.es/biology",
    "https://explorabl.es/journalism",
    "https://omarshehata.github.io/lda-explorable/",
    "https://explorabl.es/math",
    "https://explorabl.es/programming",
    "https://lewis500.github.io/socialsecurity/",
    "https://explorabl.es/economics",
    "https://www.youtube.com/watch?v=xrDZ--AuiL8",
    "https://explorabl.es/reading",
    "https://www.osar.fr/notes/waveguides/",
    "https://explorabl.es/art",
    "https://explorabl.es/math",
    "http://tinlizzie.org/histograms/",
    "https://explorabl.es/art",
    "https://explorabl.es/math",
    "http://www.playfulinvention.com/emergence/",
    "https://explorabl.es/meta",
    "https://timmarco.com/fitts/",
    "https://explorabl.es/art",
    "http://web.archive.org/web/20170707110554/http://sineridergame.com/",
    "https://explorabl.es/math",
    "http://www.npr.org/sections/money/2015/05/21/408234543/will-your-job-be-done-by-a-machine",
    "https://explorabl.es/economics",
    "https://explorabl.es/journalism",
    "http://ncase.me/simulating/model/",
    "https://explorabl.es/tools",
    "https://chrisuehlinger.com/LambdaBubblePop/",
    "https://explorabl.es/programming",
    "https://complex-analysis.com/",
    "https://explorabl.es/math",
    "https://online-go.com/learn-to-play-go",
    "https://explorabl.es/misc",
    "https://www.nytimes.com/interactive/2015/07/03/upshot/a-quick-puzzle-to-test-your-problem-solving.html",
    "https://explorabl.es/psychology",
    "https://www.philosophersmag.com/games",
    "https://explorabl.es/philosophy",
    "http://blog.vctr.me/monty-hall/",
    "https://explorabl.es/math",
    "https://en.wikipedia.org/wiki/Explorable_explanation",
    "https://explorabl.es/reading",
    "https://gabriellelamarrlemee.github.io/thesis-simulation/",
    "https://explorabl.es/journalism",
    "https://teropa.info/loop/",
    "https://explorabl.es/art",
    "https://www.nytimes.com/interactive/2017/04/02/technology/uber-drivers-psychological-tricks.html",
    "https://explorabl.es/journalism",
    "https://mrpandey.github.io/d3graphTheory/",
    "https://explorabl.es/math",
    "http://ncase.me/matrix/",
    "https://explorabl.es/math",
    "http://www.r2d3.us/covid-19/",
    "https://explorabl.es/biology",
    "http://worrydream.com/Tangle/",
    "https://explorabl.es/tools",
    "https://explore.paulbutler.org/electoral/",
    "https://explorabl.es/civics",
    "https://www.nytimes.com/interactive/2019/04/10/opinion/privacy-survey.html",
    "https://explorabl.es/journalism",
    "http://omrelli.ug/g9/gallery/",
    "https://explorabl.es/tools",
    "https://www.strangeloopgames.com/eco/",
    "https://explorabl.es/earth",
    "https://syntopia.github.io/StrangeAttractors/",
    "https://explorabl.es/math",
    "https://xeniasuper.github.io/recaman-sequence/",
    "https://explorabl.es/math",
    "http://setosa.io/pythagorean/",
    "https://explorabl.es/math",
    "https://distill.pub/2017/aia/",
    "https://explorabl.es/art",
    "https://explorabl.es/programming",
    "https://pmneila.github.io/jsexp/grayscott/",
    "https://explorabl.es/chemistry",
    "https://idyll.pub/post/the-eye-5b169094cce3bece5d95e964/",
    "https://explorabl.es/biology",
    "http://rupertdeese.com/critters/",
    "https://explorabl.es/biology",
    "http://glench.github.io/fuzzyset.js/ui/",
    "https://explorabl.es/programming",
    "http://michaelnielsen.org/reinventing_explanation/",
    "https://explorabl.es/reading",
    "https://meltingasphalt.com/interactive/outbreak/",
    "https://explorabl.es/biology",
    "https://quantum.country/search",
    "https://explorabl.es/physics",
    "https://explorabl.es/programming",
    "http://worrydream.com/ClimateChange/",
    "https://explorabl.es/earth",
    "http://aprt.us/",
    "https://explorabl.es/tools",
    "http://polytrope.com/simplenumbers/",
    "https://explorabl.es/math",
    "https://auroriax.com/puzzle-explorable/",
    "https://explorabl.es/art",
    "http://joshuahhh.com/projects/hysteresis/",
    "https://explorabl.es/physics",
    "https://pudding.cool/2018/04/birthday-paradox/",
    "https://explorabl.es/math",
    "http://ncase.me/loopy/",
    "https://explorabl.es/tools",
    "http://blog.ncase.me/i-do-and-i-understand/",
    "https://explorabl.es/tutorials",
    "http://blog.ncase.me/how-i-make-an-explorable-explanation/",
    "https://explorabl.es/tutorials",
    "http://www.metanetsoftware.com/technique/tutorialA.html",
    "https://explorabl.es/programming",
    "http://setosa.io/ev/",
    "https://explorabl.es/math",
    "http://collectivedebate.mit.edu/",
    "https://explorabl.es/civics",
    "https://aresluna.org/segmented-type/",
    "https://explorabl.es/misc",
    "http://www.r2d3.us/visual-intro-to-machine-learning-part-1/",
    "https://explorabl.es/programming",
    "https://fold.it/",
    "https://explorabl.es/biology",
    "https://explorabl.es/chemistry",
    "https://ncase.me/attractors/",
    "https://explorabl.es/biology",
    "https://explorabl.es/math",
    "http://cognitivemedium.com/tat/index.html",
    "https://explorabl.es/reading",
    "http://setosa.io/blog/2014/09/02/gridlock/",
    "https://explorabl.es/misc",
    "http://blog.ncase.me/explorable-explanations/",
    "https://explorabl.es/tutorials",
    "https://flowingdata.com/2015/09/23/years-you-have-left-to-live-probably/",
    "https://explorabl.es/journalism",
    "http://www.redblobgames.com/articles/visibility/",
    "https://explorabl.es/programming",
    "http://www.testtubegames.com/velocityraptor.html",
    "https://explorabl.es/physics",
    "http://www.fakeittomakeitgame.com/",
    "https://explorabl.es/journalism",
    "http://rocknpoll.graphics/",
    "https://explorabl.es/civics",
    "https://explorabl.es/math",
    "https://mathisonian.github.io/trig/etymology/",
    "https://explorabl.es/math",
    "http://crossingdivides.bbcnewslabs.co.uk/",
    "https://explorabl.es/civics",
    "http://www.math.ucla.edu/~tao/QED/QED.html",
    "https://explorabl.es/math",
    "https://phet.colorado.edu/",
    "https://explorabl.es/biology",
    "https://explorabl.es/chemistry",
    "https://explorabl.es/earth",
    "https://explorabl.es/math",
    "https://explorabl.es/physics",
    "https://observablehq.com/@jajoosam/mathe-carlo/2",
    "https://explorabl.es/math",
    "https://www.euclidea.xyz/",
    "https://explorabl.es/math",
    "http://ncase.me/joy/",
    "https://explorabl.es/tools",
    "https://www.bloomberg.com/features/2016-etf-files/toy/",
    "https://explorabl.es/economics",
    "https://www.tomlum.com/the-time-trials",
    "https://explorabl.es/biology",
    "https://www.lucify.com/inside-einsteins-head/",
    "https://explorabl.es/physics",
    "http://www.emergentmind.com/",
    "https://explorabl.es/biology",
    "https://explorabl.es/art",
    "https://explorabl.es/biology",
    "https://explorabl.es/chemistry",
    "https://explorabl.es/civics",
    "https://explorabl.es/earth",
    "https://explorabl.es/economics",
    "https://explorabl.es/journalism",
    "https://explorabl.es/math",
    "https://explorabl.es/meta",
    "https://explorabl.es/misc",
    "https://explorabl.es/philosophy",
    "https://explorabl.es/physics",
    "https://explorabl.es/programming",
    "https://explorabl.es/psychology",
    "https://explorabl.es/social",
    "https://explorabl.es/tools",
    "https://explorabl.es/tutorials",
    "https://explorabl.es/reading",
    "https://explorabl.es/faq",
    "https://explorabl.es/all",
    "https://twitter.com/explorables",
    "https://www.reddit.com/r/explorables/",
    "https://github.com/explorableexplanations/explorableexplanations.github.io#explorable-explanations",
    "https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fexplorabl.es%2F&t=Explorable%20Explanations%2C%20a%20hub%20for%20learning%20through%20play%3A",
    "https://twitter.com/intent/tweet?source=http%3A%2F%2Fexplorabl.es%2F&text=Explorable%20Explanations%2C%20a%20hub%20for%20learning%20through%20play%3A%20http%3A%2F%2Fexplorabl.es%2F"
]